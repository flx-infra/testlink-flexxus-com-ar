version: '3.6'

services:
  testlink-db:
    image: mariadb:10.11
    container_name: testlink-mariadb
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: Flexxus2023**
      MYSQL_DATABASE: testlink
      MYSQL_USER: testlink
      MYSQL_PASSWORD: Flexxus2023**
    volumes:
      - testlink-db-data:/var/lib/mysql
    networks:
      - traefik     
    healthcheck:
      test: ["CMD", "healthcheck.sh", "--connect", "--innodb_initialized"]
      interval: 10s
      timeout: 5s
      retries: 5

  testlink:
    image: bitnami/testlink:1.9.20
    restart: unless-stopped
    ports:
      - "8080:8080"
      - "8443:8443"
    environment:
      # Configuración de base de datos
      TESTLINK_DATABASE_HOST: testlink-db
      TESTLINK_DATABASE_PORT_NUMBER: 3306
      TESTLINK_DATABASE_NAME: testlink
      TESTLINK_DATABASE_USER: testlink
      TESTLINK_DATABASE_PASSWORD: Flexxus2023**

      # Configuración de TestLink
      TESTLINK_USERNAME: admin
      TESTLINK_PASSWORD: admin123
      TESTLINK_EMAIL: admin@testlink.local

      # Configuración adicional
      ALLOW_EMPTY_PASSWORD: "no"

      # PHP settings (opcional)
      PHP_MEMORY_LIMIT: 512M
      PHP_MAX_EXECUTION_TIME: 300
      PHP_UPLOAD_MAX_FILESIZE: 20M
      PHP_POST_MAX_SIZE: 20M
    volumes:
      - testlink-data:/bitnami/testlink
      - testlink-uploads:/opt/bitnami/testlink/upload_area
    networks:
      - traefik     
    depends_on:
      - testlink-db

volumes:
  testlink-db-data:
    driver: local
  testlink-data:
    driver: local
  testlink-uploads:
    driver: local

traefik:
    external:
      name: traefik-network
